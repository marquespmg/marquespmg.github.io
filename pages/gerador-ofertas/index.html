import { useState } from 'react';
import styles from '/style.module.css';

export default function GeradorOfertas() {
  const [acessoPermitido, setAcessoPermitido] = useState(false);
  const [produtos, setProdutos] = useState([]);
  const [senha, setSenha] = useState('');

  const verificarSenha = () => {
    if (senha === "PMG@2024") { // Altere para sua senha
      setAcessoPermitido(true);
      carregarProdutos();
    } else {
      alert("Senha incorreta!");
    }
  };

  const carregarProdutos = async () => {
    try {
      const response = await fetch('/produtos.json');
      const data = await response.json();
      setProdutos(data);
    } catch (error) {
      console.error("Erro ao carregar produtos:", error);
    }
  };

  const gerarImagem = (produto) => {
    // Implemente a geração de imagem aqui
    console.log("Gerando imagem para:", produto.name);
    // Use o código Canvas que te mostrei anteriormente
  };

  const gerarTextoOfertas = () => {
    let texto = `🛍️ OFERTAS ESPECIAIS\n\n`;
    produtos.forEach((prod, i) => {
      texto += `${i+1}. ${prod.name}\n   💰 R$ ${prod.price.toFixed(2)}\n\n`;
    });
    
    navigator.clipboard.writeText(texto)
      .then(() => alert('Texto copiado!'))
      .catch(err => console.error("Erro ao copiar:", err));
  };

  if (!acessoPermitido) {
    return (
      <div className={styles.authBox}>
        <h2>🔒 Acesso Restrito</h2>
        <input
          type="password"
          value={senha}
          onChange={(e) => setSenha(e.target.value)}
          placeholder="Digite a senha"
        />
        <button onClick={verificarSenha}>Acessar</button>
      </div>
    );
  }

  return (
    <div className={styles.container}>
      <h1>Gerador de Ofertas</h1>
      
      <div className={styles.controles}>
        <button onClick={() => produtos.forEach(gerarImagem)}>
          Gerar Todas as Imagens
        </button>
        <button onClick={gerarTextoOfertas}>
          Copiar Texto de Ofertas
        </button>
      </div>
      
      <div className={styles.produtosGrid}>
        {produtos.map(produto => (
          <div key={produto.id} className={styles.produtoCard}>
            <img 
              src={produto.image} 
              alt={produto.name}
              onError={(e) => e.target.src = '/placeholder.png'}
            />
            <h3>{produto.name}</h3>
            <p>R$ {produto.price.toFixed(2)}</p>
            <button onClick={() => gerarImagem(produto)}>
              Gerar Imagem
            </button>
          </div>
        ))}
      </div>
    </div>
  );

}
